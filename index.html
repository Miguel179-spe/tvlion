<!DOCTYPE html> 
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Series+ - Plataforma de Streaming</title>
<style>
:root {
    --primary-color: #e50914;
    --background-dark: #141414;
    --background-card: #181818;
    --background-secondary: #222;
    --text-light: #fff;
    --muted: #b3b3b3;
    --radius: 8px;
    --transition: 0.25s ease;
    --focus-shadow: 0 0 25px rgba(229, 9, 20, 0.9);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: var(--background-dark);
    color: var(--text-light);
    overflow-x: hidden;
}

/* Loader */
.loader {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--primary-color);
    font-size: 1.5rem;
    z-index: 1000;
}

.loader.hidden {
    display: none;
}

/* HEADER */
header {
    padding: 15px 40px;
    background: rgba(0,0,0,0.9);
    position: sticky;
    top: 0;
    display: flex;
    gap: 15px;
    align-items: center;
    z-index: 10;
    backdrop-filter: blur(10px);
}

.logo { 
    font-weight: bold; 
    font-size: 1.8rem; 
    color: var(--primary-color);
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}

/* Status indicator */
.status-indicator {
    margin-left: auto;
    padding: 5px 12px;
    background: rgba(255,255,255,0.1);
    border-radius: 20px;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.status-indicator.connected::before {
    content: "";
    width: 8px;
    height: 8px;
    background: #46d369;
    border-radius: 50%;
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

/* MAIN GRID - M√°s columnas */
.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 12px;
    padding: 20px 40px;
    animation: fadeIn 0.1s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.card {
    background: transparent;
    border-radius: 5px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    border: 2px solid transparent;
    outline: none;
}

.card img { 
    width: 100%; 
    height: auto;
    aspect-ratio: 2/3;
    object-fit: cover;
    transition: transform 0.1s ease;
}

.card-title { 
    padding: 10px; 
    font-size: 0.85rem; 
    font-weight: 500;
    background: linear-gradient(180deg, transparent, rgba(0,0,0,0.9));
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    color: white;
}

.card.focused {
    border-color: var(--primary-color);
    transform: scale(1.15);
    box-shadow: var(--focus-shadow);
    z-index: 5;
}

.card.focused img {
    transform: scale(1.05);
}

/* Focus ring for accessibility */
.card:focus-visible,
.season:focus-visible,
.episode:focus-visible {
    outline: 3px solid var(--primary-color);
    outline-offset: 2px;
}

/* BADGES */
.badge {
    position: absolute;
    top: 6px;
    left: 6px;
    background: var(--primary-color);
    padding: 3px 8px;
    font-size: 0.65rem;
    border-radius: 4px;
    font-weight: bold;
    z-index: 2;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.badge.doblado { 
    background: #46d369; 
}

.badge.estreno { 
    background: #ff6b35;
    animation: glow 2s ease-in-out infinite;
}

@keyframes glow {
    0%, 100% { box-shadow: 0 0 5px currentColor; }
    50% { box-shadow: 0 0 20px currentColor; }
}

/* SERIES OVERLAY */
.series-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--background-dark);
    z-index: 100;
    overflow-y: auto;
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
}

/* Series Banner */
.series-banner {
    position: relative;
    height: 250px;
    overflow: hidden;
    margin-bottom: 20px;
}

.series-banner-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    filter: blur(10px) brightness(0.4);
    transform: scale(1); /* alejada (antes 1.1) */
}

.series-banner-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
        to bottom,
        rgba(0,0,0,0.2) 0%,
        rgba(0,0,0,0.6) 60%,
        var(--background-dark) 100%
    );
}

.series-banner-content {
    position: relative;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    padding: 40px;
    z-index: 2;
    text-align: center;
}

.series-header {
    font-size: 3.5rem;
    font-weight: 700;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.9);
    margin-bottom: 15px;
    animation: fadeInDown 0.5s ease-out;
}

.series-meta {
    font-size: 1.2rem;
    color: var(--text-light);
    opacity: 0.9;
}

@keyframes fadeInDown {
    from { 
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Season Carousel (wrapper + buttons) */
.season-carousel {
    position: relative;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 40px 30px;
}

.season-bar {
    display: flex;
    gap: 16px;
    padding: 0;
    overflow-x: auto;
    scrollbar-width: none;
    scroll-behavior: smooth;
    justify-content: flex-start;
}

.season-bar::-webkit-scrollbar {
    display: none;
}

/* Botones de temporadas ocultos */
.season-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 40px;
    height: 60px;
    background: rgba(0,0,0,0.8);
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    z-index: 11;
    transition: all 0.3s ease;
    display: none !important; /* oculto */
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    opacity: 0.7;
}
.season-btn.prev { left: 0; }
.season-btn.next { right: 0; }
.season-btn.disabled { opacity: 0.3; cursor: not-allowed; }

.season {
    background: rgba(24, 24, 24, 0.85);
    border-radius: var(--radius);
    padding: 12px 24px;
    color: var(--muted);
    border: 2px solid transparent;
    transition: all var(--transition);
    cursor: pointer;
    font-weight: 500;
    white-space: nowrap;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    outline: none;
    position: relative;
}

.season::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 3px;
    background: var(--primary-color);
    transition: all 0.3s ease;
    transform: translateX(-50%);
}

.season.focused {
    border-color: var(--primary-color);
    color: var(--text-light);
    transform: scale(1.08);
    background: rgba(24, 24, 24, 0.95);
    box-shadow: 0 8px 16px rgba(0,0,0,0.5);
}

.season.active {
    background: var(--primary-color);
    color: #fff;
    box-shadow: 0 6px 12px rgba(229, 9, 20, 0.4);
}

.season.active::after {
    width: 100%;
}

/* Episodes Carousel Container */
.episodes-container {
    background: var(--background-dark);
    padding: 20px 0 40px;
    position: relative;
}

.episodes-carousel {
    position: relative;
    overflow: visible; /* para que no se recorte el foco en TV */
    padding: 0 40px;
    max-width: 1200px; /* centrado */
    margin-left: auto;
    margin-right: auto;
}

.episodes-track {
    display: flex;
    gap: 15px;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Carousel Navigation Buttons (ocultos) */
.carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 50px;
    height: 100px;
    background: rgba(0,0,0,0.8);
    border: none;
    color: white;
    font-size: 2rem;
    cursor: pointer;
    z-index: 10;
    transition: all 0.3s ease;
    display: none !important; /* oculto */
    align-items: center;
    justify-content: center;
    opacity: 0;
}

.carousel-btn.prev { left: 0; border-radius: 0 8px 8px 0; }
.carousel-btn.next { right: 0; border-radius: 8px 0 0 8px; }
.carousel-btn.disabled { opacity: 0.3 !important; cursor: not-allowed; }

/* Episode Cards - Carousel Style */
.episode {
    flex: 0 0 300px;
    background: var(--background-card);
    border-radius: var(--radius);
    border: 2px solid transparent;
    transition: all var(--transition);
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    cursor: pointer;
    outline: none;
}

.episode:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 12px rgba(0,0,0,0.5);
}

.thumb {
    background: linear-gradient(135deg, #333, #1a1a1a);
    height: 170px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--muted);
    font-size: 0.9rem;
    position: relative;
    overflow: hidden;
}

.thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.ep-number {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.9);
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: bold;
}

.episode.focused {
    border-color: var(--primary-color);
    transform: scale(1.08);
    box-shadow: var(--focus-shadow);
    z-index: 5;
}

.episode.bloqueado {
    opacity: 0.4;
    cursor: not-allowed;
    filter: grayscale(1);
}

.episode.bloqueado::after {
    content: "üîí";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    z-index: 10;
}

.ep-info {
    padding: 14px;
    background: linear-gradient(180deg, var(--background-card), rgba(0,0,0,0.5));
}

.ep-title {
    font-size: 0.95rem;
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.play-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 50px;
    height: 50px;
    background: rgba(229, 9, 20, 0.95);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
}

.episode.focused .play-icon,
.episode:hover .play-icon {
    opacity: 1;
}

.play-icon::after {
    content: "‚ñ∂";
    color: white;
    font-size: 1.2rem;
    margin-left: 3px;
}

/* Carousel Indicators */
.carousel-indicators {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 20px;
}

.indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(255,255,255,0.3);
    transition: all 0.3s ease;
    cursor: pointer;
}

.indicator.active {
    width: 24px;
    border-radius: 4px;
    background: var(--primary-color);
}

/* BACK BUTTON */
.back-button {
    position: fixed;
    top: 20px;
    left: 20px;
    background: rgba(34, 34, 34, 0.95);
    color: var(--text-light);
    border: 2px solid transparent;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    display: none;
    z-index: 201;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.back-button:hover,
.back-button:focus {
    background: var(--primary-color);
    border-color: var(--primary-color);
    transform: scale(1.05);
}

.back-button.visible {
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideInLeft 0.3s ease-out;
}

@keyframes slideInLeft {
    from { transform: translateX(-100%); }
    to { transform: translateX(0); }
}

.close {
    position: fixed;
    top: 20px;
    right: 20px;
    font-size: 2.5rem;
    cursor: pointer;
    color: white;
    z-index: 201;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.5);
    border-radius: 50%;
    transition: all 0.3s ease;
}

.close:hover {
    background: var(--primary-color);
    transform: rotate(90deg);
}

/* Error message */
.error-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(229, 9, 20, 0.95);
    color: white;
    padding: 20px 30px;
    border-radius: 10px;
    z-index: 1000;
    display: none;
    animation: shake 0.5s ease-in-out;
}

@keyframes shake {
    0%, 100% { transform: translate(-50%, -50%) rotate(0); }
    25% { transform: translate(-52%, -50%) rotate(-2deg); }
    75% { transform: translate(-48%, -50%) rotate(2deg); }
}

.error-message.show {
    display: block;
}

/* Large screens - More columns */
@media (min-width: 1400px) {
    .grid {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    }
}

@media (min-width: 1800px) {
    .grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }
}

/* TV safe: asegurar que el episodio se vea completo y centrado */
@media (min-width: 1280px) {
    .episodes-carousel {
        padding: 0 96px;   /* m√°s margen lateral para evitar recortes por overscan */
        overflow: visible; /* no recortar el foco ampliado */
    }
    .episode:hover { transform: scale(1.04); }
    .episode.focused { transform: scale(1.06); }
}

/* Responsive */
@media (max-width: 768px) {
    header, .grid {
        padding-left: 20px;
        padding-right: 20px;
    }
    
    .grid {
        grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
        gap: 8px;
    }
    
    .series-header {
        font-size: 2rem;
    }
    
    .series-banner {
        height: 180px;
    }
    
    .episode {
        flex: 0 0 250px;
    }
    
    .card.focused {
        transform: scale(1.1);
    }
}

/* Accessibility */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* High contrast mode */
@media (prefers-contrast: high) {
    .card:focus,
    .season:focus,
    .episode:focus {
        outline: 4px solid white;
    }
}
    
/* Banner m√°s peque√±o y sin difuminado */
.series-banner {
  height:  190px !important;
}

.series-banner-bg {
  filter: none !important; /* quita el blur y el oscurecido del filter */
}

</style>
</head>
<body>

<div class="loader" id="loader">Cargando series...</div>

<header>
    <div class="logo">SERIES+</div>
    <div class="status-indicator connected" id="statusIndicator">
        <span id="seriesCount"></span>
    </div>
</header>

<button class="back-button" id="backButton">
    <span>‚Üê</span>
    <span>Volver</span>
</button>

<section class="grid" id="mainGrid">
    <!-- Las tarjetas se cargar√°n din√°micamente -->
</section>

<!-- SERIES OVERLAY -->
<div id="seriesOverlay" class="series-overlay">
    <span class="close" id="closeButton">√ó</span>
    
    <!-- Banner -->
    <div class="series-banner">
        <div class="series-banner-bg" id="seriesBannerBg"></div>
        <div class="series-banner-overlay"></div>
        <div class="series-banner-content">
            <div class="series-header" id="seriesTitle">SERIE T√çTULO</div>
            <div class="series-meta" id="seasonsCount">0 temporadas disponibles</div>
        </div>
    </div>
    
    <!-- Carrusel de temporadas -->
    <div class="season-carousel">
        <button class="season-btn prev" id="seasonPrev">‚Äπ</button>
        <div class="season-bar" id="seasonBar"></div>
        <button class="season-btn next" id="seasonNext">‚Ä∫</button>
    </div>
    
    <div class="episodes-container">
        <div class="episodes-carousel">
            <button class="carousel-btn prev" id="carouselPrev">‚Äπ</button>
            <button class="carousel-btn next" id="carouselNext">‚Ä∫</button>
            <div class="episodes-track" id="episodesTrack"></div>
        </div>
        <div class="carousel-indicators" id="carouselIndicators"></div>
    </div>
</div>

<!-- Error message -->
<div class="error-message" id="errorMessage">
    Error cargando el contenido
</div>

<script>
<script>
/* =======================================================
   STREAMING PLATFORM ‚Äî SCRIPT ULTRA OPTIMIZADO
   ======================================================= */

class StreamingPlatform {
    constructor() {
        this.seriesData = {};
        this.cards = [];
        this.index = 0;
        this.currentSeries = null;
        this.currentSeriesId = null;
        this.currentSeason = 0;
        this.focusMode = "season";
        this.seasonFocus = 0;
        this.episodeFocus = 0;
        this.carouselPosition = 0;
        this.episodesPerView = 0;

        // JSON principal
        this.dataUrl = 'series-data.json';

        this.initializeElements();
        this.loadData();
        this.setupCarousel();
        this.setupSeasonCarousel();
    }

    /* =============================
       CACHE + PRECARGA DE JSON
       ============================= */
    async loadData() {
        try {
            this.showLoader(true);

            /* 1. Intentar cargar desde cach√© ‚Äî INMEDIATO */
            const cached = localStorage.getItem('series-data');
            if (cached) {
                this.processSeriesData(JSON.parse(cached));
                this.renderGrid();
            }

            /* 2. Descargar nueva versi√≥n del servidor, sin bloquear */
            const response = await fetch(this.dataUrl, { cache: "no-store" });

            if (!response.ok) throw new Error("Error al obtener JSON");

            const freshData = await response.json();

            // Guardar cach√© nueva
            localStorage.setItem('series-data', JSON.stringify(freshData));

            // Renderizar datos nuevos
            this.processSeriesData(freshData);
            this.renderGrid();

        } catch (error) {
            console.warn("Error cargando JSON, usando fallback si existe");

            if (!this.seriesData || Object.keys(this.seriesData).length === 0) {
                this.loadFallbackData();
            }

        } finally {
            this.showLoader(false);
        }
    }

    /* =============================
       PROCESAR JSON
       ============================= */
    processSeriesData(data) {
        this.seriesData = {};

        if (data.series && Array.isArray(data.series)) {
            data.series.forEach(serie => {
                this.seriesData[serie.id] = {
                    title: serie.title,
                    displayTitle: serie.displayTitle,
                    poster: serie.poster,
                    badge: serie.badge,
                    badgeType: serie.badgeType,
                    seasons: serie.seasons
                };
            });
        }
    }

    /* =============================
          GRID ‚Äî RENDER R√ÅPIDO
       ============================= */
    renderGrid() {
        this.mainGrid.innerHTML = '';
        this.cards = [];

        const frag = document.createDocumentFragment();
        let index = 0;

        for (const [id, serie] of Object.entries(this.seriesData)) {
            const card = this.createCard(id, serie);
            card.style.animationDelay = `${index * 0.02}s`;
            frag.appendChild(card);
            this.cards.push(card);
            index++;
        }

        this.mainGrid.appendChild(frag);

        if (this.cards.length > 0) {
            this.index = 0;
            this.focusCard();
        }
    }

    createCard(id, serie) {
        const article = document.createElement('article');
        article.className = 'card';
        article.dataset.series = id;
        article.tabIndex = -1;

        // Badge
        if (serie.badge) {
            const badge = document.createElement('span');
            badge.className = `badge ${serie.badgeType || ''}`;
            badge.textContent = serie.badge;
            article.appendChild(badge);
        }

        // Imagen ‚Äî Lazy loading avanzado
        const img = document.createElement('img');
        img.src = serie.poster;
        img.alt = serie.displayTitle;

        img.loading = "lazy";
        img.decoding = "async";
        img.fetchPriority = "low";

        img.onerror = () => {
            img.src = 'https://via.placeholder.com/300x450?text=' + encodeURIComponent(serie.displayTitle);
        };

        article.appendChild(img);

        // T√≠tulo
        const titleDiv = document.createElement('div');
        titleDiv.className = 'card-title';
        titleDiv.textContent = serie.displayTitle;
        article.appendChild(titleDiv);

        article.addEventListener('click', () => this.openSeriesDetail(id));

        return article;
    }

    /* =============================
            SERIES DETALLE
       ============================= */
    openSeriesDetail(seriesId) {
        this.currentSeries = this.seriesData[seriesId];
        this.currentSeriesId = seriesId;
        if (!this.currentSeries) return;

        this.mainGrid.style.display = 'none';
        this.seriesOverlay.style.display = 'block';
        this.backButton.classList.add('visible');

        // Banner
        this.seriesTitle.textContent = this.currentSeries.title;
        this.seriesBannerBg.style.backgroundImage = `url('${this.currentSeries.poster}')`;

        // Temporadas
        const seasonCount = Object.keys(this.currentSeries.seasons).length;
        this.seasonsCount.textContent =
            `${seasonCount} ${seasonCount === 1 ? 'Temporada disponible' : 'Temporadas disponibles'}`;

        // Reset
        this.currentSeason = 0;
        this.focusMode = "season";
        this.seasonFocus = 0;
        this.episodeFocus = 0;
        this.carouselPosition = 0;

        this.calculateEpisodesPerView();
        this.renderSeasons();
        this.renderEpisodes();

        history.pushState({ modal: true }, "", '#' + seriesId);
    }

    /* =============================
            TEMPORADAS
       ============================= */
    renderSeasons() {
        this.seasonBar.innerHTML = '';
        const seasons = Object.keys(this.currentSeries.seasons);

        const frag = document.createDocumentFragment();

        seasons.forEach((name, i) => {
            const seasonDiv = document.createElement('div');
            seasonDiv.className = 'season';
            seasonDiv.textContent = name;
            seasonDiv.dataset.index = i;
            seasonDiv.tabIndex = -1;

            if (i === this.currentSeason) seasonDiv.classList.add('active');

            seasonDiv.addEventListener('click', () => {
                this.currentSeason = i;
                this.focusMode = 'episode';
                this.seasonFocus = i;
                this.episodeFocus = 0;
                this.carouselPosition = 0;

                this.renderSeasons();
                this.renderEpisodes();
            });

            frag.appendChild(seasonDiv);
        });

        this.seasonBar.appendChild(frag);
        this.updateSeasonButtons();
        this.updateSeriesFocus();
    }

    /* =============================
             EPISODIOS
       ============================= */
    renderEpisodes() {
        this.episodesTrack.innerHTML = '';
        const seasonKeys = Object.keys(this.currentSeries.seasons);
        const episodes = this.currentSeries.seasons[seasonKeys[this.currentSeason]];

        const frag = document.createDocumentFragment();

        episodes.forEach((ep, i) => {
            const episodeDiv = document.createElement('div');
            episodeDiv.className = 'episode';
            episodeDiv.tabIndex = -1;
            if (ep.locked) episodeDiv.classList.add('bloqueado');

            /* Thumbnail */
            const thumb = document.createElement('div');
            thumb.className = 'thumb';

            const epNum = document.createElement('div');
            epNum.className = 'ep-number';
            epNum.textContent = `E${i + 1}`;
            thumb.appendChild(epNum);

            if (ep.thumbnail) {
                const img = document.createElement('img');
                img.src = ep.thumbnail;
                img.loading = 'lazy';
                img.decoding = 'async';
                img.fetchPriority = "low";
                img.alt = ep.title;
                thumb.appendChild(img);
            } else {
                thumb.textContent = ep.title;
            }

            const playIcon = document.createElement('div');
            playIcon.className = 'play-icon';
            thumb.appendChild(playIcon);

            episodeDiv.appendChild(thumb);

            /* Info */
            const epInfo = document.createElement('div');
            epInfo.className = 'ep-info';

            const epTitle = document.createElement('div');
            epTitle.className = 'ep-title';
            epTitle.textContent = ep.title;
            epInfo.appendChild(epTitle);

            episodeDiv.appendChild(epInfo);
            episodeDiv.dataset.index = i;

            if (!ep.locked && ep.url) {
                episodeDiv.addEventListener('click', () => this.playEpisode(ep.url));
            }

            frag.appendChild(episodeDiv);
        });

        this.episodesTrack.appendChild(frag);

        // Reset carrusel
        this.carouselPosition = 0;
        this.calculateEpisodesPerView();
        this.createCarouselIndicators();
        this.updateCarouselButtons();
        this.updateCarouselPosition();
        this.updateSeriesFocus();
    }

    /* =============================
       FOCO Y NAVEGACI√ìN
       ============================= */

    focusCard() {
        if (this.cards.length === 0) return;

        this.cards.forEach(c => {
            c.classList.remove('focused');
            c.tabIndex = -1;
        });

        const card = this.cards[this.index];

        if (card) {
            card.classList.add('focused');
            card.tabIndex = 0;
            card.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
        }
    }

    openCard() {
        if (this.cards[this.index]) this.cards[this.index].click();
    }

    /* =============================
          PLAY EPISODIO
       ============================= */
    playEpisode(url) {
        if (url && url !== "#") {
            this.saveProgress();
            window.location.href = url;
        }
    }

    saveProgress() {
        if (this.currentSeries) {
            const progress = {
                seriesId: this.currentSeriesId,
                season: this.currentSeason,
                episode: this.episodeFocus
            };
            localStorage.setItem('lastWatched', JSON.stringify(progress));
        }
    }

    /* =============================
            CERRAR MODAL
       ============================= */
    closeModal() {
        this.seriesOverlay.style.display = 'none';
        this.backButton.classList.remove('visible');
        this.mainGrid.style.display = 'grid';

        if (this.currentSeriesId) {
            const idx = this.cards.findIndex(
                c => c.dataset.series === this.currentSeriesId
            );
            if (idx !== -1) {
                this.index = idx;
                this.focusCard();
            }
        }

        history.replaceState(null, '', ' ');
    }

    /* =============================
        TECLADO
       ============================= */
    handleKeyboard(e) {
        if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Enter', 'Escape', 'Backspace'].includes(e.key)) {
            e.preventDefault();
        }

        if (this.seriesOverlay.style.display === "block") {
            this.handleSeriesNavigation(e);
        } else {
            this.handleGridNavigation(e);
        }
    }

    /* =============================
         LOADER / ERRORES
       ============================= */
    showLoader(show) {
        this.loader.classList.toggle('hidden', !show);
    }

    showError(msg) {
        this.errorMessage.textContent = msg;
        this.errorMessage.classList.add('show');
        setTimeout(() => this.errorMessage.classList.remove('show'), 3000);
    }

    /* =============================
            FALLBACK
       ============================= */
    loadFallbackData() {
        this.seriesData = {
            "demo": {
                title: "Series Demo",
                displayTitle: "Serie Demo",
                poster: "https://via.placeholder.com/300x450",
                seasons: {
                    "Temporada 1": [
                        { title: "Episodio 1", url: "#" },
                        { title: "Episodio 2", url: "#" },
                        { title: "Episodio 3", url: "#" }
                    ]
                }
            }
        };

        this.renderGrid();
    }
}

/* =======================================================
   INICIALIZACI√ìN DEL SISTEMA
   ======================================================= */

let platform = null;

document.addEventListener("DOMContentLoaded", () => {
    platform = new StreamingPlatform();

    document.addEventListener('keydown', (e) => platform.handleKeyboard(e));

    window.addEventListener('popstate', () => {
        if (platform.seriesOverlay.style.display === 'block') {
            platform.closeModal();
        }
    });

    window.streamingPlatform = platform;
});
</script>


</body>
</html>




